id: typescript-type-safety
name: "TypeScript Type Safety Violations"
description: "PR relaxes type checking to handle external data, introducing multiple type safety issues and potential runtime errors."
language: typescript
difficulty: medium
categories: [bug, typescript]

pr:
  title: "Make user validation more flexible for external APIs"
  description: "Updated user validation to handle various data formats from external APIs and added metadata support."

issues:
  - id: unsafe-type-assertion
    severity: high
    category: bug
    file: src/userValidator.ts
    line_start: 11
    line_end: 12
    title: "Unsafe type assertion without validation"
    description: "The data parameter is cast to User type without proper validation, bypassing TypeScript's type safety and potentially causing runtime errors."
    keywords: [type assertion, type safety, runtime error, validation, unknown]

  - id: missing-type-checks
    severity: high
    category: bug
    file: src/userValidator.ts
    line_start: 24
    line_end: 26
    title: "Missing type checks for age property"
    description: "The age property is accessed without checking if it exists or is a number, which can cause runtime errors if age is undefined or non-numeric."
    keywords: [type check, undefined, runtime error, typeof]

  - id: any-type-parameter
    severity: medium
    category: bug
    file: src/userValidator.ts
    line_start: 36
    line_end: 36
    title: "Using 'any' type for isValidEmail parameter"
    description: "The isValidEmail method accepts 'any' type instead of string, losing type safety and potentially passing non-string values to regex test."
    keywords: [any type, type safety, parameter type]

  - id: unsafe-metadata-access
    severity: high
    category: bug
    file: src/userValidator.ts
    line_start: 57
    line_end: 59
    title: "Unsafe access to untyped metadata property"
    description: "The metadata.customPermissions is accessed without type checking, and the spread operator is used on a potentially non-iterable value."
    keywords: [optional chaining, type guard, runtime error, spread operator]

  - id: type-bypass-update
    severity: critical
    category: bug
    file: src/userValidator.ts
    line_start: 77
    line_end: 79
    title: "Type system bypass in updateUserField"
    description: "The method allows setting any field with any value, completely bypassing TypeScript's type system and potentially corrupting the User object."
    keywords: [type safety, any cast, object mutation, type system bypass]

  - id: missing-roles-validation
    severity: high
    category: bug
    file: src/userValidator.ts
    line_start: 43
    line_end: 55
    title: "No validation that roles is an array"
    description: "The getUserPermissions method iterates over user.roles without checking if it's an array, causing runtime errors if roles is undefined or not iterable."
    keywords: [array validation, runtime error, type guard, Array.isArray]